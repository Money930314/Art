<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>晨哥陶藝工作室</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="list.css">


</head>
<body>
  <section id="home" class="hero-carousel" data-theme="dark">
    <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="hero-bg placeholder-image">陶藝作品背景圖 1</div>
          <div class="carousel-caption">
            <h1>手作之美</h1>
            <p>用雙手塑造生活中的美好時光</p>
            <button class="btn btn-shop">SHOP NOW</button>
          </div>
        </div>
        <div class="carousel-item">
          <div class="hero-bg placeholder-image">陶藝作品背景圖 2</div>
          <div class="carousel-caption">
            <h1>工藝傳承</h1>
            <p>傳統技法與現代美學的完美融合</p>
            <button class="btn btn-shop">SHOP NOW</button>
          </div>
        </div>
        <div class="carousel-item">
          <div class="hero-bg placeholder-image">陶藝作品背景圖 3</div>
          <div class="carousel-caption">
            <h1>最新作品</h1>
            <p>每一件作品都承載著匠人的心血與溫度</p>
            <button class="btn btn-shop">SHOP NOW</button>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>
  </section>

  <nav class="navbar navbar-expand-lg nav-dark navbar-dark" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="#">晨哥</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"><a class="nav-link" href="#home">首頁</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">作品分類</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" data-category="teaware">茶具系列</a></li>
              <li><a class="dropdown-item" href="#" data-category="dinnerware">餐具系列</a></li>
              <li><a class="dropdown-item" href="#" data-category="decorative">裝飾系列</a></li>
              <li><a class="dropdown-item" href="#" data-category="functional">生活用品</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="#gallery">全部作品</a></li>
          <li class="nav-item"><a class="nav-link" href="#about">作品文章</a></li>
        </ul>
        <div class="d-flex align-items-center gap-3">
          <a href="#"><i class="bi bi-instagram"></i></a>
          <a href="#"><i class="bi bi-youtube"></i></a>
          <a href="#"><i class="bi bi-search"></i></a>
          <div id="accountArea">
            <a href="#" id="userBtn"><i class="bi bi-person"></i></a>
          </div>
          <a href="#" id="cartToggle" class="position-relative" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer" aria-controls="cartDrawer">
            <i class="bi bi-cart"></i>
            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-cart">0</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <section class="filter-section" id="gallery" data-theme="light">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center mb-5">
          <h2 class="display-4 mb-4" style="color:#000;">精選作品</h2>
        </div>
      </div>
      <div class="filter-controls">
        <button class="filter-btn active" data-filter="all">全部作品</button>
        <button class="filter-btn" data-filter="teaware">茶具系列</button>
        <button class="filter-btn" data-filter="dinnerware">餐具系列</button>
        <button class="filter-btn" data-filter="decorative">裝飾系列</button>
        <button class="filter-btn" data-filter="functional">生活用品</button>
        <select class="sort-select ms-3">
          <option value="name">依名稱排序</option>
          <option value="price-low">價格：低到高</option>
          <option value="price-high">價格：高到低</option>
          <option value="newest">最新作品</option>
        </select>
      </div>
    </div>
  </section>

  <section class="product-grid" data-theme="light">
    <div class="container">
      <div class="row" id="productGrid"></div>
    </div>
  </section>

  <section class="about-section" id="about" data-theme="light">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <h2 class="display-4 mb-4" style="color:#000;">關於工作室</h2>
          <p class="lead mb-4">我們專注於傳統陶藝技法與現代設計的融合，每一件作品都是獨一無二的藝術品。</p>
          <p class="mb-4">從選土、拉坯、修坯到燒製，每個步驟都傾注了我們對陶藝的熱愛與堅持。工作室成立於2020年，致力於創造實用與美感兼具的陶瓷器皿。</p>
        </div>
        <div class="col-lg-6">
          <div class="placeholder-image" style="height:400px;border-radius:15px">工作室照片</div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer" data-theme="dark">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 mb-4">
          <h5>晨哥陶藝工作室</h5>
          <p>每一件作品都承載著匠人的心血與溫度，用雙手塑造生活中的美好時光。</p>
        </div>
        <div class="col-lg-4 mb-4">
          <h5>聯絡資訊</h5>
          <p><i class="bi bi-telephone me-2"></i> 0912-345-678</p>
          <p><i class="bi bi-envelope me-2"></i> pottery@studio.com</p>
          <p><i class="bi bi-geo-alt me-2"></i> 台中市西區美術館附近</p>
        </div>
        <div class="col-lg-4 mb-4">
          <h5>追蹤我們</h5>
          <div class="social-icons">
            <a href="#"><i class="bi bi-instagram"></i></a>
            <a href="#"><i class="bi bi-youtube"></i></a>
            <a href="#"><i class="bi bi-facebook"></i></a>
          </div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-12 text-center">
          <p>&copy; 2025 晨哥陶藝工作室 版權所有</p>
        </div>
      </div>
    </div>
  </footer>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartDrawer" aria-labelledby="cartDrawerLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="cartDrawerLabel">購物車</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="關閉"></button>
    </div>
    <div class="offcanvas-body">
      <ul id="cartList" class="list-group mb-3"></ul>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">小計</span>
        <strong id="cartSubtotal">NT$ 0</strong>
      </div>
      <button id="btnCheckout" class="btn btn-dark w-100" disabled>前往結帳</button>
      <div class="form-text mt-2">* 需登入會員才可結帳（示範）。</div>
    </div>
  </div>
          <div class="form-text mt-3">* 示範用：資料儲存在瀏覽器 LocalStorage。</div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

  <script>
    function setNavHeightVar(){
      const nav = document.getElementById('mainNav');
      if(!nav) return;
      const h = nav.offsetHeight || 80;
      document.documentElement.style.setProperty('--navH', h + 'px');
    }
    window.addEventListener('resize', setNavHeightVar, {passive:true});
    document.addEventListener('DOMContentLoaded', setNavHeightVar);
    setNavHeightVar();
  </script>

  <script>
    (function() {
      const nav = document.getElementById('mainNav');
      const themedBlocks = Array.from(document.querySelectorAll('section[data-theme], footer[data-theme]'));
      let lastTheme = null;
      function updateNavTheme() {
        const navH = nav.offsetHeight;
        const current = themedBlocks.find(el => {
          const r = el.getBoundingClientRect();
          return r.top <= navH && r.bottom > navH;
        }) || themedBlocks[0];
        const theme = (current?.getAttribute('data-theme')) || 'light';
        if (theme !== lastTheme) {
          nav.classList.toggle('nav-dark', theme === 'dark');
          nav.classList.toggle('nav-light', theme === 'light');
          nav.classList.toggle('navbar-dark', theme === 'dark');
          nav.classList.toggle('navbar-light', theme === 'light');
          lastTheme = theme;
        }
      }
      window.addEventListener('scroll', updateNavTheme, {passive:true});
      window.addEventListener('resize', updateNavTheme);
      document.addEventListener('DOMContentLoaded', updateNavTheme);
      updateNavTheme();
    })();
  </script>

  <script>
    const products=[
      {id:1,name:'青瓷茶壺',category:'teaware',description:'傳統拉坯技法製作，青瓷釉面溫潤如玉，容量350ml',price:1800,priceText:'NT$ 1,800',image:null,available:true,featured:true},
      {id:2,name:'手工茶杯組',category:'teaware',description:'一組四入，每只杯子都有獨特的釉色變化',price:1200,priceText:'NT$ 1,200',image:null,available:true,featured:false},
      {id:3,name:'白瓷花器',category:'decorative',description:'簡約現代造型，純白釉面，適合各種花材',price:680,priceText:'NT$ 680',image:null,available:false,featured:true},
      {id:4,name:'手沖咖啡濾杯',category:'functional',description:'V60造型，內壁螺旋紋路，完美萃取咖啡精華',price:450,priceText:'NT$ 450',image:null,available:true,featured:false},
      {id:5,name:'竹節餐具組',category:'dinnerware',description:'竹節造型碗盤組合，自然質樸的餐桌美學',price:950,priceText:'NT$ 950',image:null,available:true,featured:true},
      {id:6,name:'香薰燭台',category:'decorative',description:'鏤空設計，光影交錯，營造溫馨氛圍',price:520,priceText:'NT$ 520',image:null,available:true,featured:false},
      {id:7,name:'日式湯碗',category:'dinnerware',description:'深碗造型，適合盛裝湯品，釉色深邃如夜空',price:380,priceText:'NT$ 380',image:null,available:true,featured:false},
      {id:8,name:'文房筆筒',category:'functional',description:'古樸典雅，書房必備，底部防滑設計',price:420,priceText:'NT$ 420',image:null,available:true,featured:false},
      {id:9,name:'薄胎茶盞',category:'teaware',description:'超薄胎體，輕若蟬翼，品茶極品',price:2200,priceText:'NT$ 2,200',image:null,available:true,featured:true}
    ];
    let filteredProducts=[...products];
    function getCategoryName(k){const m={teaware:'茶具系列',dinnerware:'餐具系列',decorative:'裝飾系列',functional:'生活用品'};return m[k]||'其他'}
    function renderProducts(productsToRender = filteredProducts) {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = productsToRender.map(p => `
          <div class="product-item" data-category="${p.category}">
            <div class="product-card">
              <a class="card-link" href="product.html?id=${p.id}">前往商品</a>
              ${!p.available ? '<div class="sold-out-badge">售完</div>' : ''}
              <div class="product-image">
                ${p.image ? `<img src="${p.image}" alt="${p.name}">` : `<div class="placeholder-image">${p.name}</div>`}
              </div>
              <div class="product-info">
                <div class="product-category">${getCategoryName(p.category)}</div>
                <h3 class="product-name">${p.name}</h3>
                <p class="product-description">${p.description ?? ''}</p>
                <div class="product-price">NT$ ${p.price.toLocaleString('zh-TW')}</div>
                <button class="btn btn-add-cart ${!p.available ? 'sold-out' : ''}"
                        ${!p.available ? 'disabled' : ''}
                        onclick="addToCart && addToCart(${p.id}, 1)">
                  ${p.available ? '加入購物車' : '售完'}
                </button>
              </div>
            </div>
          </div>
        </div>`).join('');
      renderCart();
    }
    function filterProducts(cat){filteredProducts=(cat==='all')?[...products]:products.filter(p=>p.category===cat);renderProducts();document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));const btn=document.querySelector(`[data-filter="${cat}"]`);if(btn)btn.classList.add('active')}
    function sortProducts(mode){switch(mode){case 'name':filteredProducts.sort((a,b)=>a.name.localeCompare(b.name,'zh-TW'));break;case 'price-low':filteredProducts.sort((a,b)=>a.price-b.price);break;case 'price-high':filteredProducts.sort((a,b)=>b.price-a.price);break;case 'newest':filteredProducts.sort((a,b)=>b.id-a.id);break;}renderProducts()}
    document.addEventListener('DOMContentLoaded',()=>{
      renderProducts();
      document.querySelectorAll('.filter-btn').forEach(btn=>btn.addEventListener('click',()=>filterProducts(btn.getAttribute('data-filter'))));
      document.querySelectorAll('.dropdown-item').forEach(item=>item.addEventListener('click',e=>{e.preventDefault();const c=item.getAttribute('data-category');if(c){filterProducts(c);document.getElementById('gallery').scrollIntoView({behavior:'smooth'})}}));
      document.querySelector('.sort-select').addEventListener('change',function(){sortProducts(this.value)});
      document.querySelectorAll('a[href^="#"]').forEach(a=>a.addEventListener('click',e=>{const href=a.getAttribute('href');if(href&&href.startsWith('#')&&href.length>1){e.preventDefault();const t=document.querySelector(href);if(t)t.scrollIntoView({behavior:'smooth',block:'start'})}}));
    });
  </script>

  <script>
    const CART_KEY = 'cart:v1';
    const cart = {
      items: {},
      load(){ try{ this.items = JSON.parse(localStorage.getItem(CART_KEY)) || {}; }catch{ this.items = {}; } },
      save(){ localStorage.setItem(CART_KEY, JSON.stringify(this.items)); },
      add(id, qty=1){
        const p = products.find(x=>x.id===id);
        if(!p || !p.available) return;
        const item = this.items[id] || { id, name:p.name, price:p.price, image:p.image||null, qty:0 };
        item.qty += qty; this.items[id]=item; this.save(); renderCart();
      },
      setQty(id, qty){
        qty = Math.max(0, parseInt(qty||0,10));
        if(qty<=0) delete this.items[id];
        else if(this.items[id]) this.items[id].qty = qty;
        this.save(); renderCart();
      },
      remove(id){ delete this.items[id]; this.save(); renderCart(); },
      count(){ return Object.values(this.items).reduce((a,b)=>a+b.qty,0); },
      subtotal(){ return Object.values(this.items).reduce((a,b)=>a+b.qty*b.price,0); }
    };
    function money(n){ return 'NT$ ' + (n||0).toLocaleString('zh-TW'); }
    function renderCart(){
      const list = document.getElementById('cartList');
      const items = Object.values(cart.items);
      if(!items.length){
        list.innerHTML = '<li class="list-group-item text-center text-muted">購物車是空的</li>';
      }else{
        list.innerHTML = items.map(it=>`
          <li class="list-group-item">
            <div class="d-flex align-items-start gap-2">
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between">
                  <strong>${it.name}</strong>
                  <span>${money(it.price * it.qty)}</span>
                </div>
                <div class="d-flex align-items-center gap-2 mt-2">
                  <button class="btn btn-sm btn-outline-secondary qty-dec" data-id="${it.id}">-</button>
                  <input type="number" min="1" class="form-control form-control-sm qty-input" value="${it.qty}" data-id="${it.id}" style="width:70px">
                  <button class="btn btn-sm btn-outline-secondary qty-inc" data-id="${it.id}">+</button>
                  <button class="btn btn-sm btn-outline-danger ms-auto remove" data-id="${it.id}"><i class="bi bi-trash"></i></button>
                </div>
              </div>
            </div>
          </li>
        `).join('');
      }
      document.getElementById('cartSubtotal').textContent = money(cart.subtotal());
      document.getElementById('cartCount').textContent = cart.count();
      document.getElementById('btnCheckout').disabled = !items.length;
    }
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.btn-add-cart[data-id]');
      if(btn){ const id = +btn.dataset.id; cart.add(id, 1); }
    });
    document.getElementById('cartList').addEventListener('click', (e)=>{
      const inc = e.target.closest('.qty-inc');
      const dec = e.target.closest('.qty-dec');
      const rm  = e.target.closest('.remove');
      if(inc){ const id = +inc.dataset.id; cart.setQty(id, (cart.items[id]?.qty||1)+1); }
      if(dec){ const id = +dec.dataset.id; cart.setQty(id, (cart.items[id]?.qty||1)-1); }
      if(rm){ const id = +rm.dataset.id; cart.remove(id); }
    });
    document.getElementById('cartList').addEventListener('change',(e)=>{
      const inp = e.target.closest('.qty-input'); if(inp){ cart.setQty(+inp.dataset.id, inp.value); }
    });
    document.addEventListener('DOMContentLoaded', ()=>{ cart.load(); renderCart(); });
  </script>

  <script>
    const API_BASE =
      location.origin.startsWith('http')
        ? '' // 部署在 Vercel 同網域
        : 'https://YOUR_VERCEL_DOMAIN_HERE'; // 若用本機 file:// 測試，改成你的 Vercel 網域

    document.getElementById('btnCheckout').addEventListener('click', async () => {
      if (!Auth.isLoggedIn()) { openPanel("login"); return; }

      const items = Object.values(cart.items).map(it => ({
        name: it.name, price: it.price, qty: it.qty, product_id: it.id
      }));

      if (!items.length) { alert('購物車是空的'); return; }

      try {
        const resp = await fetch(`${API_BASE}/api/checkout-ecpay`, {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({
            items,
            email: Auth.currentUser()?.email || '',
            name:  Auth.currentUser()?.name  || '',
            user_id: null
          })
        });

        const ct = resp.headers.get('content-type') || '';
        const text = await resp.text();

        if (resp.ok && ct.includes('text/html')) {
          document.open(); document.write(text); document.close();
        } else {
          alert(`結帳發生錯誤（${resp.status}）：\n${text}`);
        }
      } catch (err) {
        console.error(err);
        alert('結帳連線失敗，請稍後重試');
      }
    });
  </script>

  <script>
    const USERS_KEY = 'users:v1';
    const SESSION_KEY = 'session:v1';
    const Auth = {
      users: {}, session: null,
      load(){ try{ this.users = JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }catch{ this.users = {}; } this.session = JSON.parse(localStorage.getItem(SESSION_KEY) || 'null'); },
      save(){ localStorage.setItem(USERS_KEY, JSON.stringify(this.users)); localStorage.setItem(SESSION_KEY, JSON.stringify(this.session)); },
      signup(name, email, password){
        email = email.trim().toLowerCase();
        if(this.users[email]) throw new Error('此 Email 已註冊');
        this.users[email] = { name, email, password };
        this.session = { email }; this.save(); return this.users[email];
      },
      login(email, password){
        email = email.trim().toLowerCase();
        const u = this.users[email];
        if(!u || u.password !== password) throw new Error('帳號或密碼錯誤');
        this.session = { email }; this.save(); return u;
      },
      logout(){ this.session = null; this.save(); },
      isLoggedIn(){ return !!(this.session && this.users[this.session.email]); },
      currentUser(){ return this.isLoggedIn() ? this.users[this.session.email] : null; }
    };

    function closeAuthModal(){
      const el = document.getElementById('authModal');
      const inst = bootstrap.Modal.getOrCreateInstance(el);
      inst.hide();
      document.body.classList.remove('modal-open');
      document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
    }

    function refreshAccountUI(){
      const area = document.getElementById('accountArea');
      if(!area) return;
      if(!Auth.isLoggedIn()){
        area.innerHTML = '<a href="#" id="userBtn"><i class="bi bi-person"></i></a>';
      }else{
        const u = Auth.currentUser();
        area.innerHTML = `
          <div class="dropdown">
            <a class="d-inline-flex align-items-center text-decoration-none dropdown-toggle" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i><span>Hi, ${u.name}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" id="btnViewOrders">我的訂單（示範）</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="btnLogout">登出</a></li>
            </ul>
          </div>`;
        area.querySelector('#btnLogout').addEventListener('click', (e)=>{ e.preventDefault(); Auth.logout(); refreshAccountUI(); });
        area.querySelector('#btnViewOrders').addEventListener('click', (e)=>{ e.preventDefault(); alert('示範：尚未串接訂單列表'); });
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      Auth.load(); refreshAccountUI();

      document.getElementById('loginForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const pass  = document.getElementById('loginPassword').value;
        try{
          Auth.login(email, pass);
          refreshAccountUI();
          closeAuthModal();
        }catch(err){ alert(err.message || err); }
      });

      document.getElementById('signupForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const name = document.getElementById('signupName').value;
        const email= document.getElementById('signupEmail').value;
        const pass = document.getElementById('signupPassword').value;
        try{
          Auth.signup(name, email, pass);
          refreshAccountUI();
          closeAuthModal();
        }catch(err){ alert(err.message || err); }
      });
    });
  </script>
  <!-- Account Side Panel -->
  <div id="accOverlay" class="account-overlay"></div>
  <div id="accPanel" class="account-panel" aria-modal="true" role="dialog" aria-labelledby="accTitle" aria-hidden="true">
    <div class="account-card position-relative">
      <button class="acc-close" id="accClose" aria-label="關閉"><i class="bi bi-x-lg"></i></button>
      <div class="account-grid">
        <div class="acc-visual">
          <div class="brand">晨哥</div>
          <div class="vtxt">Welcome back.</div>
        </div>
        <div class="acc-form">
          <div class="w-100">
            <div class="tabs">
              <button class="tab active" id="tabLogin">登入</button>
              <button class="tab" id="tabSignup">註冊</button>
            </div>

            <div id="paneLogin">
              <h3 id="accTitle" class="mb-2">登入帳號</h3>
              <form id="loginFormPanel" class="vstack gap-3">
                <div>
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" id="loginEmailPanel" required>
                </div>
                <div>
                  <label class="form-label">密碼</label>
                  <input type="password" class="form-control" id="loginPasswordPanel" required>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="rememberMePanel">
                    <label class="form-check-label" for="rememberMePanel">記住我</label>
                  </div>
                  <a href="#" id="btnResetPanel">忘記密碼？</a>
                </div>
                <button type="submit" class="btn btn-dark w-100">登入</button>
              </form>
              <div class="text-muted mt-2">還沒有帳號？ <a href="#" class="switch-signup">前往註冊</a></div>
            </div>
            <div id="paneSignup" hidden>
              <h3 class="mb-2">建立新帳號</h3>
              <form id="signupFormPanel" class="vstack gap-3">
                <div>
                  <label class="form-label">全名</label>
                  <input type="text" class="form-control" id="signupNamePanel" placeholder="王小明" required>
                </div>
                
                <div>
                  <label class="form-label">電話</label>
                  <input type="tel" class="form-control" id="signupPhonePanel" placeholder="0912345678" pattern="^[0-9]{10}$" required>
                  <div class="form-text">需為 10 碼數字</div>
                  <div id="signupPhoneStatus" class="small mt-1 text-muted">目前 0/10 位</div>
                </div>
                <div>
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" id="signupEmailPanel" required>
                </div>
                <div>
                  <label class="form-label">密碼</label>
                  <input type="password" class="form-control" id="signupPasswordPanel" minlength="6" required>
                  <div id="signupPwdHint" class="form-text">請輸入英文字母及數字共 6~12 字元</div>
                  <div id="signupPwdStatus" class="small mt-1 text-muted">尚未輸入</div>
                </div>
                <button type="submit" class="btn btn-dark w-100">註冊</button>
              </form>
              <div class="text-muted mt-2">已經有帳號了？<a href="#" class="switch-login">立即登入</a></div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Side Panel controller (robust with delegation)
    (function(){
      const $ = sel => document.querySelector(sel);
      const overlay = $('#accOverlay');
      const panel   = $('#accPanel');
      const tabLogin= $('#tabLogin');
      const tabSignup=$('#tabSignup');
      const paneLogin=$('#paneLogin');
      const paneSignup=$('#paneSignup');

    function openPanel(mode='login'){
      // 只開自己的面板，不動購物車或任何 backdrop
      const overlay = document.getElementById('accOverlay');
      const panel   = document.getElementById('accPanel');
      overlay?.classList.add('show');
      panel?.classList.add('show');
      document.body.style.overflow = 'hidden';

      // 切換分頁
      if (typeof switchTab === 'function') switchTab(mode);

      // 自動聚焦第一個欄位
      setTimeout(()=>{
        const input = (mode === 'login')
          ? document.getElementById('loginEmailPanel')
          : document.getElementById('signupNamePanel');
        input?.focus();
        input?.select();
      }, 30);
    }

    function closePanel(){
      const overlay = document.getElementById('accOverlay');
      const panel   = document.getElementById('accPanel');
      overlay?.classList.remove('show');
      panel?.classList.remove('show');
      document.body.style.overflow = '';
    }
      function switchTab(mode){
        const login = mode==='login';
        tabLogin?.classList.toggle('active', login);
        tabSignup?.classList.toggle('active', !login);
        if(paneLogin) paneLogin.hidden = !login;
        if(paneSignup) paneSignup.hidden = login;
        setTimeout(()=>{
          const input = login ? document.getElementById('loginEmailPanel')
                              : document.getElementById('signupNamePanel');
          input?.focus(); input?.select();
        }, 10);
      }

      // Event delegation: handle clicks on #userBtn even if icon nested
      function bindEvents(){
        document.addEventListener('click', function(e){
          // open panel from person icon
          if (e.target.closest('#userBtn')) {
            e.preventDefault();
            openPanel('login');
            return;
          }
          // tab toggles
          if (e.target.closest('#tabLogin')) { e.preventDefault(); switchTab('login'); return; }
          if (e.target.closest('#tabSignup')) { e.preventDefault(); switchTab('signup'); return; }
          if (e.target.closest('.switch-signup')) { e.preventDefault(); switchTab('signup'); return; }
          if (e.target.closest('.switch-login')) { e.preventDefault(); switchTab('login'); return; }
          if (e.target.closest('#accClose')) { e.preventDefault(); closePanel(); return; }
          if (e.target === overlay) { closePanel(); return; }
        });

        // Login submit
        document.getElementById('loginFormPanel')?.addEventListener('submit', (ev)=>{
          ev.preventDefault();
          const email = document.getElementById('loginEmailPanel').value;
          const pass  = document.getElementById('loginPasswordPanel').value;
          try{
            if (window.Auth?.login) {
              Auth.login(email, pass);
            }
            if (window.refreshAccountUI) refreshAccountUI();
            closePanel();
          }catch(err){ alert(err.message || err); }
        });

        
        // --- Realtime validation for phone & password in Signup ---
        const phoneInput = document.getElementById('signupPhonePanel');
        const phoneStatus = document.getElementById('signupPhoneStatus');
        const pwdInput   = document.getElementById('signupPasswordPanel');
        const pwdStatus  = document.getElementById('signupPwdStatus');

        function updatePhoneStatus(){
          if(!phoneInput || !phoneStatus) return true;
          const v = (phoneInput.value || '').trim();
          const ok = /^[0-9]{10}$/.test(v);
          if(v.length === 0){
            phoneStatus.textContent = '目前 0/10 位';
            phoneStatus.className = 'small mt-1 text-muted';
            return false;
          }
          if(ok){
            phoneStatus.textContent = '格式正確';
            phoneStatus.className = 'small mt-1 text-success';
          }else{
            phoneStatus.textContent = `目前 ${v.length}/10 位，請輸入 10 位數字`;
            phoneStatus.className = 'small mt-1 text-danger';
          }
          return ok;
        }
        function updatePwdStatus(){
          if(!pwdInput || !pwdStatus) return true;
          const v = pwdInput.value || '';
          const lenOk = /^[A-Za-z0-9]{6,12}$/.test(v);
          const mixOk = /[A-Za-z]/.test(v) && /[0-9]/.test(v);
          if(v.length === 0){
            pwdStatus.textContent = '尚未輸入';
            pwdStatus.className = 'small mt-1 text-muted';
            return false;
          }
          if(lenOk && mixOk){
            pwdStatus.textContent = '密碼格式正確';
            pwdStatus.className = 'small mt-1 text-success';
            return true;
          }else{
            let msg = [];
            if(!lenOk) msg.push('長度需為 6~12 位英數字');
            if(!mixOk) msg.push('需同時包含英文字母與數字');
            pwdStatus.textContent = msg.join('，');
            pwdStatus.className = 'small mt-1 text-danger';
            return false;
          }
        }
        phoneInput?.addEventListener('input', updatePhoneStatus);
        pwdInput?.addEventListener('input', updatePwdStatus);
        // 初始化提示
        updatePhoneStatus();
        updatePwdStatus();

        // Signup submit
        document.getElementById('signupFormPanel')?.addEventListener('submit', (ev)=>{
          ev.preventDefault();
          const name  = document.getElementById('signupNamePanel').value;
          const phone = document.getElementById('signupPhonePanel')?.value || '';
          const email = document.getElementById('signupEmailPanel').value;
          const pass  = document.getElementById('signupPasswordPanel').value;
          if (!/^[0-9]{10}$/.test(phone)) { alert('電話需為 10 碼數字'); return; }
          try{
            if (window.Auth?.signup) {
              // 傳入 phone 作為第 4 參數；若既有 Auth.signup 只吃 3 個參數，JS 會自動忽略多餘參數
              Auth.signup(name, email, pass, phone);
            }
            if (window.refreshAccountUI) refreshAccountUI();
            closePanel();
          }catch(err){ alert(err.message || err); }
        });

        // Reset password (fallback demo)
        document.getElementById('btnResetPanel')?.addEventListener('click', async (e)=>{
          e.preventDefault();
          if (window.Auth?.resetPassword) {
            try { await Auth.resetPassword(); } catch(err){ alert(err.message || err); }
          } else {
            const email = prompt('請輸入註冊 Email，用來重設密碼：');
            if (!email) return;
            alert('系統會寄送重設密碼連結到：' + email + '（示意）');
          }
        });
      }

      document.addEventListener('DOMContentLoaded', bindEvents);
      // Expose to global for other code to open this panel
      window.openPanel = openPanel;
    })();
  </script>

</body>
</html>
